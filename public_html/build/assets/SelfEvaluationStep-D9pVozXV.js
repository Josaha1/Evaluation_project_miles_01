import{K as z,r as m,j as e,S as w,b as P}from"./app-DM3CWPwz.js";import{M as F,B as A}from"./MainLayout-yPW0h5_m.js";import{P as O}from"./ProgressIndicator-BDROIFSf.js";import{A as Q,Q as M}from"./QuestionCard-zAM7LM2Q.js";import{m as x}from"./proxy-Bj0QQS72.js";import{U as R}from"./user-Cq3tEQKy.js";import{C as U}from"./circle-check-big-BBsAKVXT.js";import{C as B}from"./circle-alert-bOP-Vpir.js";import{A as T}from"./arrow-left-L5hVJ2YX.js";import{S as D}from"./send-CExb7qFm.js";import{A as $}from"./arrow-right-lAGf90R3.js";import"./utils-ONoQxm8A.js";import"./x--rbPaS5b.js";import"./input-mdXLdbQx.js";function oe(){const{evaluation:_,current_part:h,step:d,total_steps:f,evaluatee_id:q,is_self:J,auth:C,group_index_to_resume:y,existingAnswers:v}=z().props,[u,b]=m.useState({}),[i,g]=m.useState(0),[j,c]=m.useState(!1);m.useEffect(()=>{if(v){const t={};Object.entries(v).forEach(([s,r])=>{const o=parseInt(s);let p=r;if(typeof r=="string")try{p=JSON.parse(r)}catch{p=r}t[o]=p}),b(t)}else b({})},[v]);const n=h.aspects.flatMap(t=>{const s=new Set,r=(t.subaspects||[]).map(l=>(l.questions.forEach(I=>s.add(I.id)),{aspectName:t.name,subaspectName:l.name,subaspectDescription:l.description||null,questions:l.questions})),o=t.questions.filter(l=>!s.has(l.id)),p=o.length>0?[{aspectName:t.name,subaspectName:null,subaspectDescription:null,questions:o}]:[];return[...r,...p]}),a=n[i];m.useEffect(()=>{if(new URLSearchParams(window.location.search).get("goto_last")==="1"&&n.length>0){g(n.length-1);const s=new URL(window.location.href);s.searchParams.delete("goto_last"),window.history.replaceState({},"",s.toString())}},[n.length]);const E=(t,s)=>{b(r=>({...r,[t]:s}))},N=a.questions.every(t=>{const s=u[t.id];return s!==void 0&&s!==""&&!(Array.isArray(s)&&s.length===0)}),L=()=>{i>0?g(i-1):d>1?(c(!0),w.visit(route("evaluations.self.questions",{step:d-1,goto_last:1}),{method:"get",preserveScroll:!1,preserveState:!1,onFinish:()=>{c(!1),window.scrollTo({top:0,behavior:"smooth"})},onError:()=>{c(!1),alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤")}})):w.visit(route("dashboard"))},G=async()=>{const t=a.questions.reduce((s,r)=>{const o=u[r.id];return o!==void 0&&o!==""&&(s[r.id]=o),s},{});if(Object.keys(t).length>0){c(!0);try{await P.post(route("evaluations.self.step",{step:d}),{evaluation_id:_.id,part_id:h.id,evaluatee_id:q??C.user.id,answers:t})}catch(s){console.error("Error saving answers:",s),alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà"),c(!1);return}c(!1)}i<n.length-1?g(i+1):(c(!0),w.visit(route("evaluations.self.questions",{step:d+1}),{method:"get",preserveScroll:!0,preserveState:!1}))};m.useEffect(()=>{typeof y=="number"&&g(y)},[y]);const k=i===n.length-1,S=d===f;return e.jsx(F,{title:"‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á",children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-violet-50 via-white to-indigo-50 dark:from-gray-900 dark:via-gray-800 dark:to-violet-900/20",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 py-6 sm:py-8",children:[e.jsxs(x.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[e.jsx(R,{className:"text-violet-600 dark:text-violet-400",size:20}),e.jsx("h1",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 dark:text-white",children:"‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á"})]}),e.jsxs("div",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-gray-200/50 dark:border-gray-700/50",children:[e.jsx("h2",{className:"text-base sm:text-lg lg:text-xl font-semibold text-violet-700 dark:text-violet-400 mb-4",children:h.title}),e.jsx(O,{currentStep:d,totalSteps:f,currentGroup:i,totalGroups:n.length})]})]}),e.jsx(Q,{mode:"wait",children:e.jsxs(x.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.4,ease:"easeInOut"},className:"space-y-4 sm:space-y-6",children:[!a.subaspectName&&a.aspectName&&e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-violet-500 to-indigo-600 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white",children:[e.jsxs("h3",{className:"text-base sm:text-lg lg:text-xl font-bold mb-2",children:["üìã ",a.aspectName]}),e.jsxs("p",{className:"text-sm sm:text-base text-violet-100 leading-relaxed",children:["‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ (",a.questions.length," ‡∏Ç‡πâ‡∏≠)"]})]}),e.jsx("div",{className:"space-y-4 sm:space-y-6",children:a.questions.map((t,s)=>e.jsx(M,{question:t,answer:u[t.id],onAnswerChange:r=>E(t.id,r),questionNumber:s+1},t.id))}),e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},className:`flex items-center justify-center space-x-2 p-4 rounded-xl ${N?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-orange-50 dark:bg-orange-900/20 text-orange-700 dark:text-orange-400"}`,children:N?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:20}),e.jsx("span",{className:"font-medium",children:"‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß"}),a.aspectName&&e.jsxs("span",{className:"text-xs bg-green-100 dark:bg-green-800/30 px-2 py-1 rounded",children:["‡∏î‡πâ‡∏≤‡∏ô: ",a.aspectName]})]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{size:20}),e.jsxs("span",{className:"font-medium",children:["‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠ (",a.questions.filter(t=>{const s=u[t.id];return s!==void 0&&s!==""&&!(Array.isArray(s)&&s.length===0)}).length,"/",a.questions.length,")"]}),a.aspectName&&e.jsxs("span",{className:"text-xs bg-orange-100 dark:bg-orange-800/30 px-2 py-1 rounded",children:["‡∏î‡πâ‡∏≤‡∏ô: ",a.aspectName]})]})})]},i)}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-6 sm:mt-8 p-4 sm:p-6 lg:p-8 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-xl sm:rounded-2xl border border-gray-200/50 dark:border-gray-700/50 shadow-lg",children:e.jsxs("div",{className:"space-y-4 lg:space-y-0 lg:grid lg:grid-cols-3 lg:gap-6 lg:items-center",children:[e.jsx("div",{className:"flex justify-start",children:e.jsxs(A,{variant:"outline",onClick:L,disabled:j,className:"flex items-center space-x-2 px-4 py-2 sm:px-6 sm:py-3 w-auto min-w-[120px] transition-all duration-200 hover:scale-105 disabled:hover:scale-100",children:[e.jsx(T,{size:16,className:"sm:w-5 sm:h-5"}),e.jsx("span",{className:"font-medium",children:"‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö"})]})}),e.jsxs("div",{className:"text-center space-y-2 lg:space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm sm:text-base font-medium text-gray-700 dark:text-gray-300",children:["‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ",i+1," ‡∏à‡∏≤‡∏Å ",n.length]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:["‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà ",d," ‡∏à‡∏≤‡∏Å ",f]})]}),e.jsxs("div",{className:"w-full max-w-xs mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤"}),e.jsxs("span",{children:[Math.round((i+1)/n.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-violet-500 to-indigo-600 h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${(i+1)/n.length*100}%`}})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(A,{onClick:G,disabled:!N||j,className:"flex items-center space-x-2 px-4 py-2 sm:px-6 sm:py-3 w-auto min-w-[140px] bg-gradient-to-r from-violet-600 to-indigo-600 hover:from-violet-700 hover:to-indigo-700 transition-all duration-200 hover:scale-105 disabled:hover:scale-100 shadow-lg",children:j?e.jsxs(e.Fragment,{children:[e.jsx(x.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-4 h-4 sm:w-5 sm:h-5 border-2 border-white border-t-transparent rounded-full"}),e.jsx("span",{className:"font-medium",children:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium",children:k?S?"‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô":"‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ":"‡∏ñ‡∏±‡∏î‡πÑ‡∏õ"}),k&&S?e.jsx(D,{size:16,className:"sm:w-5 sm:h-5"}):e.jsx($,{size:16,className:"sm:w-5 sm:h-5"})]})})})]})})]})})})}export{oe as default};
