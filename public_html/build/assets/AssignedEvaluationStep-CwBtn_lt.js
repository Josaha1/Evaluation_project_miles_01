import{K as _,r as y,j as a,b as D,S as E}from"./app-DQ2VkJ7f.js";import{M as G,B as b}from"./MainLayout-BTc9pcGZ.js";import{m as f}from"./proxy-DiGbqXPe.js";import{A as I}from"./index-DOQihDPJ.js";import"./Footer-TA0Z8X7z.js";import"./utils-ONoQxm8A.js";function P(){const{evaluation:v,current_part:p,step:c,total_steps:g,evaluatee_id:x,auth:M,groupIndex:j}=_().props,[m,N]=y.useState({}),[o,w]=y.useState(j||0),h=p.aspects.flatMap(t=>{const e=(t.subaspects||[]).length>0,r=e?(t.subaspects||[]).map(l=>({subaspectName:l.name,subaspectDescription:l.description||null,questions:l.questions})):[],i=!e&&t.questions.length>0?[{subaspectName:t.name,subaspectDescription:null,questions:t.questions}]:[];return[...r,...i]}),n=h[o],k=n.questions.every(t=>{const e=m[t.id];return e!==void 0&&e!==""&&!(Array.isArray(e)&&e.length===0)}),d=(t,e)=>{N(r=>({...r,[t]:e}))},A=async()=>{const t=n.questions.reduce((e,r)=>{const i=m[r.id];return i!==void 0&&i!==""&&(e[r.id]=i),e},{});if(Object.keys(t).length>0)try{await D.post(route("assigned-evaluations.step",{evaluatee:x,step:c}),{evaluation_id:v.id,part_id:p.id,evaluatee_id:x,answers:t})}catch(e){return console.error("Error saving answers:",e),alert("เกิดข้อผิดพลาดในการบันทึก กรุณาลองใหม่")}o<h.length-1?w(o+1):E.visit(route("assigned-evaluations.show",{evaluateeId:x,step:c+1}),{method:"get",preserveScroll:!0,preserveState:!1})},S=t=>{var i,l;const e=m[t.id]||"",r=s=>{var u;return e===s||((u=e==null?void 0:e.includes)==null?void 0:u.call(e,s))};switch(t.type){case"rating":return a.jsx("div",{className:"flex justify-center gap-2",children:[5,4,3,2,1].map(s=>a.jsx(b,{variant:r(s)?"default":"outline",className:"w-12 h-12 rounded-full",onClick:()=>d(t.id,s),children:s},s))});case"choice":return a.jsx("div",{className:"space-y-3 text-left",children:(i=t.options)==null?void 0:i.map(s=>a.jsx("button",{onClick:()=>d(t.id,s.id),className:`w-full px-4 py-3 border rounded-lg shadow-sm transition-all
                  ${r(s.id)?"bg-black text-white border-black":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100 dark:bg-gray-900 dark:text-white dark:border-gray-700 dark:hover:bg-gray-800"}`,children:a.jsx("span",{className:"block break-words text-sm md:text-base",children:s.label})},s.id))});case"multiple_choice":return a.jsx("div",{className:"space-y-2",children:(l=t.options)==null?void 0:l.map(s=>a.jsx(b,{variant:r(s.id)?"default":"outline",onClick:()=>{const u=e!=null&&e.includes(s.id)?e.filter(C=>C!==s.id):[...e||[],s.id];d(t.id,u)},className:"w-full",children:s.label},s.id))});case"open_text":return a.jsx("textarea",{value:e,onChange:s=>d(t.id,s.target.value),rows:4,className:"w-full p-3 border rounded text-black dark:text-white bg-white dark:bg-gray-800",placeholder:"พิมพ์ความคิดเห็นของคุณ..."});default:return null}};return a.jsx(G,{title:"แบบประเมินผู้ได้รับมอบหมาย",children:a.jsxs("div",{className:"max-w-2xl mx-auto py-12 px-6 space-y-6",children:[a.jsxs(f.h2,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-xl font-bold text-indigo-700 text-center",children:["ตอนที่ ",c," / ",g,": ",p.title]}),a.jsx(I,{mode:"wait",children:a.jsxs(f.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"bg-gray-50 dark:bg-gray-800 p-6 rounded-xl shadow-md",children:[n.subaspectName&&a.jsxs("div",{className:"mb-4",children:[a.jsxs("p",{className:"text-sm font-semibold text-blue-700",children:["ด้านย่อย: ",n.subaspectName]}),n.subaspectDescription&&a.jsx("p",{className:"text-sm text-gray-600",children:n.subaspectDescription})]}),n.questions.map(t=>a.jsxs("div",{className:"mb-6 text-left",children:[a.jsx("h4",{className:"text-base font-semibold text-indigo-700 mb-2",children:t.title}),S(t)]},t.id))]},o)}),a.jsx("div",{className:"text-center",children:a.jsx(b,{size:"lg",onClick:A,disabled:!k,className:"px-8 py-3 text-lg",children:o===h.length-1?c===g?"ส่งแบบประเมิน":"ไปยังตอนถัดไป":"ถัดไป"})})]})})}export{P as default};
