import{K as P,r as m,m as z,j as e,S as _}from"./app-DQ2VkJ7f.js";import{M as F,B as w,t as u}from"./MainLayout-BTc9pcGZ.js";import{S as C}from"./react-select.esm-DSdaeHML.js";import{C as O}from"./card-DdDD-iKT.js";import{B as U}from"./breadcrumb-D7MOHieF.js";import{c as $}from"./createLucideIcon-Ce0Y5JqW.js";import{I as S,C as b}from"./info-O1PNlwX_.js";import{U as L}from"./users-YEsL161P.js";import{T}from"./trash-2-DGdS9yBe.js";import"./Footer-TA0Z8X7z.js";import"./utils-ONoQxm8A.js";/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],H=$("plus",q);/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],R=$("user-check",K),E=[{value:"top",label:"องศาบน (เจ้านาย)",description:"ผู้บังคับบัญชาที่อยู่ในสายการบังคับบัญชาโดยตรง",icon:"⬆️"},{value:"bottom",label:"องศาล่าง (ลูกน้อง)",description:"ผู้ใต้บังคับบัญชาที่อยู่ในสายการบังคับบัญชาโดยตรง",icon:"⬇️"},{value:"left",label:"องศาซ้าย (เพื่อนสายงานเดียวกัน)",description:"เพื่อนร่วมงานในสายงานเดียวกันหรือระดับเดียวกัน",icon:"⬅️"},{value:"right",label:"องศาขวา (สายงานอื่นเกี่ยวข้อง)",description:"ผู้ที่มาจากสายงานอื่นที่เกี่ยวข้องหรือผู้ประเมินภายนอก",icon:"➡️"}];function ae(){const{users:f}=P().props,c=m.useMemo(()=>f.map(s=>{var i,o,r,t,d,k;return{value:s.id,label:`${s.prename}${s.fname} ${s.lname} (${((i=s.position)==null?void 0:i.title)??s.position_title??"ไม่ระบุตำแหน่ง"} / ${((o=s.department)==null?void 0:o.name)??"ไม่ระบุหน่วยงาน"} / ${((r=s.division)==null?void 0:r.name)??"ไม่ระบุสายงาน"})`,grade:parseInt(s.grade.toString()),division_id:s.division_id,department_id:s.department_id,position_id:s.position_id,position_title:((t=s.position)==null?void 0:t.title)??s.position_title??"ไม่ระบุตำแหน่ง",user_type:s.user_type||"",division_name:((d=s.division)==null?void 0:d.name)??"ไม่ระบุสายงาน",department_name:((k=s.department)==null?void 0:k.name)??"ไม่ระบุหน่วยงาน"}}),[f]),[l,v]=m.useState(null),[j,g]=m.useState([]),[a,h]=m.useState(null),[n,x]=m.useState([]),[y,N]=m.useState(!1);z({assignments:[]});const M=s=>{if(v(s),h(null),x([]),!s){g([]);return}s.grade>=9?g(E):g(E.filter(o=>o.value==="top"||o.value==="left"))},I=s=>{h(s),x([])},A=s=>{n.find(i=>i.value===s.value)||x([...n,s])},B=s=>{x(n.filter(i=>i.value!==s))},D=async s=>{if(s.preventDefault(),!l||!a||n.length===0){u.error("กรุณาเลือกข้อมูลให้ครบถ้วน");return}N(!0);const i=n.map(o=>({evaluator_id:o.value,evaluatee_id:l.value,angle:a.value}));try{for(const o of i)await new Promise((r,t)=>{_.post(route("assignments.store"),o,{onSuccess:()=>r(!0),onError:d=>t(d)})});u.success(`✅ เพิ่มความสัมพันธ์สำเร็จ ${i.length} รายการ`),v(null),h(null),g([]),x([])}catch{u.error("🚫 ไม่สามารถเพิ่มความสัมพันธ์ได้ กรุณาลองใหม่")}finally{N(!1)}},p=m.useMemo(()=>{if(!l||!a)return[];const s=l.grade,i=l.division_id,o=l.department_id;let r=[];if(a.value==="top"){if(s<9)r=c.filter(t=>t.grade>=9&&t.position_title&&(t.position_title.includes("ผู้อำนวยการ")||t.position_title.includes("ผู้ว่าการ")||t.position_title.includes("รอง")||t.position_title.includes("ผู้ช่วย"))&&t.user_type==="internal");else if(r=c.filter(t=>t.grade>s&&t.user_type==="internal"),i){const t=r.filter(d=>d.division_id===i);t.length>0&&(r=t)}}else if(a.value==="left"){if(s<9?r=c.filter(t=>t.grade>=5&&t.grade<=8&&t.user_type==="internal"&&t.value!==l.value):r=c.filter(t=>t.grade===s&&t.user_type==="internal"&&t.value!==l.value),i){const t=r.filter(d=>d.division_id===i);t.length>0&&(r=t)}}else if(a.value==="bottom"){if(s>=9){if(r=c.filter(t=>t.grade<s&&t.user_type==="internal"),i){const t=r.filter(d=>d.division_id===i);t.length>0&&(r=t)}else if(o){const t=r.filter(d=>d.department_id===o);t.length>0&&(r=t)}}}else a.value==="right"&&(r=c.filter(t=>t.user_type==="external"));return r.filter(t=>!n.find(d=>d.value===t.value))},[l,a,c,n]);return e.jsx(F,{title:"เพิ่มความสัมพันธ์ผู้ประเมิน",breadcrumb:e.jsx(U,{items:[{label:"แดชบอร์ดผู้ดูแลระบบ",href:route("admindashboard")},{label:"จัดการผู้ประเมิน-ผู้ถูกประเมิน",href:route("assignments.index")},{label:"เพิ่มความสัมพันธ์ผู้ประเมิน - ผู้ถูกประเมิน",active:!0}]}),children:e.jsx("div",{className:"max-w-6xl mx-auto px-6 py-10",children:e.jsxs(O,{className:"p-8 shadow-xl bg-white dark:bg-zinc-900",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white mb-2",children:"✨ เพิ่มความสัมพันธ์ผู้ประเมิน - ผู้ถูกประเมิน"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"สามารถเลือกผู้ประเมินได้หลายคนต่อองศา เพื่อความครบถ้วนในการประเมิน"})]}),e.jsxs("form",{onSubmit:D,className:"space-y-8",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-6 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("label",{className:"block mb-3 text-sm font-semibold dark:text-gray-300 flex items-center",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"👤 เลือกผู้ถูกประเมิน"]}),e.jsx(C,{options:c,value:l,onChange:M,placeholder:"เลือกผู้ถูกประเมิน...",isClearable:!0,className:"react-select-container",classNamePrefix:"react-select"}),l&&e.jsx("div",{className:"mt-3 p-3 bg-white dark:bg-zinc-800 rounded border",children:e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["📊 เกรด:"," ",e.jsxs("span",{className:"font-medium",children:["C",l.grade]}),l.grade>=9?e.jsx("span",{className:"ml-2 text-green-600",children:"✅ ประเมิน 4 องศา (บน, ล่าง, ซ้าย, ขวา)"}):e.jsx("span",{className:"ml-2 text-yellow-600",children:"⚠️ ประเมิน 2 องศา (บน, ซ้าย)"})]})})]}),j.length>0&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-6 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsxs("label",{className:"block mb-3 text-sm font-semibold dark:text-gray-300 flex items-center",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"🎯 เลือกองศาการประเมิน"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:j.map(s=>e.jsxs("div",{onClick:()=>I(s),className:`p-4 border-2 rounded-lg cursor-pointer transition-all ${(a==null?void 0:a.value)===s.value?"border-green-500 bg-green-100 dark:bg-green-900/30":"border-gray-200 hover:border-gray-300 dark:border-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-medium flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:s.icon}),s.label]}),(a==null?void 0:a.value)===s.value&&e.jsx(b,{className:"w-5 h-5 text-green-500"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.description})]},s.value))})]}),a&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-6 rounded-lg border border-purple-200 dark:border-purple-800",children:[e.jsxs("label",{className:"block mb-3 text-sm font-semibold dark:text-gray-300 flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"🧑‍💼 เลือกผู้ประเมิน (",a.icon," ",a.label,")"]}),e.jsx(C,{options:p,onChange:s=>s&&A(s),placeholder:`เลือกผู้ประเมินสำหรับ${a.label}...`,isClearable:!0,value:null,className:"react-select-container mb-4",classNamePrefix:"react-select"}),n.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"text-sm font-medium mb-3 flex items-center",children:[e.jsx(b,{className:"w-4 h-4 mr-2 text-green-500"}),"ผู้ประเมินที่เลือก (",n.length," คน)"]}),e.jsx("div",{className:"space-y-2",children:n.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-zinc-800 rounded border",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-100 dark:bg-indigo-900 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-indigo-600 dark:text-indigo-400",children:i+1})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white text-sm",children:s.label.split(" (")[0]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["เกรด: C",s.grade," ","•"," ",s.user_type==="external"?"ภายนอก":"ภายใน"]})]})]}),e.jsx("button",{type:"button",onClick:()=>B(s.value),className:"text-red-500 hover:text-red-700 transition-colors p-1 rounded hover:bg-red-50",title:"ลบออกจากรายการ",children:e.jsx(T,{className:"w-4 h-4"})})]},s.value))})]}),e.jsx("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded",children:e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["💡 ผู้ประเมินที่เหมาะสม:"," ",p.length," คน",p.length===0&&n.length===0&&e.jsx("span",{className:"text-red-600 dark:text-red-400 ml-2",children:"⚠️ ไม่พบผู้ประเมินที่เหมาะสม"})]})})]}),l&&a&&n.length>0&&e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-6 rounded-lg border border-indigo-200 dark:border-indigo-800",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(b,{className:"w-5 h-5 mr-2 text-green-500"}),"📝 สรุปข้อมูลก่อนบันทึก"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"ผู้ถูกประเมิน:"}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400 mt-1",children:l.label.split(" (")[0]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"องศาการประเมิน:"}),e.jsxs("div",{className:"text-gray-600 dark:text-gray-400 mt-1",children:[a.icon," ",a.label]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"จำนวนผู้ประเมิน:"}),e.jsxs("div",{className:"text-gray-600 dark:text-gray-400 mt-1",children:["👥 ",n.length," ","คน"]})]})]})]}),e.jsxs("div",{className:"flex justify-between pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>_.visit(route("assignments.index")),className:"px-6",children:"← กลับไปหน้ารายการ"}),e.jsx(w,{type:"submit",disabled:y||n.length===0,className:"px-8",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"กำลังบันทึก..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"บันทึกความสัมพันธ์ (",n.length," รายการ)"]})})]})]}),e.jsxs("div",{className:"mt-8 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border-l-4 border-blue-500",children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"💡 คำแนะนำการใช้งาน"]}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("li",{children:"• ผู้ถูกประเมินเกรด C9-C12 จะถูกประเมินจาก 4 องศา (บน, ล่าง, ซ้าย, ขวา)"}),e.jsx("li",{children:"• ผู้ถูกประเมินเกรด C5-C8 จะถูกประเมินจาก 2 องศา (บน, ซ้าย)"}),e.jsx("li",{children:"• สามารถเลือกผู้ประเมินได้หลายคนต่อองศาเพื่อความน่าเชื่อถือ"}),e.jsx("li",{children:"• ระบบจะกรองผู้ประเมินที่เหมาะสมตามเกรดและตำแหน่งโดยอัตโนมัติ"})]})]})]})})})}export{ae as default};
