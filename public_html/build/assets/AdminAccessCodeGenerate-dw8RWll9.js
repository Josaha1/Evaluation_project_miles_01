import{K as N,m as k,r as w,j as e}from"./app-CvBoKgfj.js";import{M as C,B as A,t as o}from"./MainLayout-DXHIoJI3.js";import{B as S}from"./breadcrumb-BC5CAiAz.js";import{L as d}from"./label-CSBkD6Sn.js";import{I as x}from"./input-CLa8Wrjy.js";import{C as E}from"./card-CwtR2BCI.js";import"./utils-ONoQxm8A.js";import"./createLucideIcon-DRc0qRU9.js";import"./x-CCAKE15G.js";function Y(){const{organizations:m,evaluations:u,evaluatees:h}=N().props,g=new Date().getMonth()>=9?new Date().getFullYear()+1+543:new Date().getFullYear()+543,{data:s,setData:r,post:p,processing:n,errors:t}=k({organization_id:"",evaluation_id:"",evaluatee_ids:[],fiscal_year:String(g),expires_at:""}),[c,v]=w.useState(""),l=h.filter(a=>`${a.fname} ${a.lname} ${a.emid}`.toLowerCase().includes(c.toLowerCase())),b=a=>{r("evaluatee_ids",s.evaluatee_ids.includes(a)?s.evaluatee_ids.filter(i=>i!==a):[...s.evaluatee_ids,a])},j=()=>{const a=l.map(_=>_.id),i=[...new Set([...s.evaluatee_ids,...a])];r("evaluatee_ids",i)},y=()=>{r("evaluatee_ids",[])},f=a=>{a.preventDefault(),p(route("admin.access-codes.generate"),{onSuccess:()=>o.success("สร้าง Access Code เรียบร้อยแล้ว"),onError:()=>o.error("ไม่สามารถสร้าง Access Code ได้")})};return e.jsx(C,{title:"สร้าง Access Code",breadcrumb:e.jsx(S,{items:[{label:"แดชบอร์ดผู้ดูแลระบบ",href:route("admindashboard")},{label:"จัดการ Access Codes",href:route("admin.access-codes.index")},{label:"สร้าง Code ใหม่",active:!0}]}),children:e.jsx("div",{className:"max-w-4xl mx-auto px-6 py-10",children:e.jsxs(E,{className:"p-8 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-indigo-600",children:"สร้าง Access Code สำหรับผู้ประเมินภายนอก"}),e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(d,{children:"องค์กรภายนอก *"}),e.jsxs("select",{value:s.organization_id,onChange:a=>r("organization_id",a.target.value),className:"w-full border rounded px-3 py-2 dark:bg-gray-800 dark:text-white dark:border-gray-600",children:[e.jsx("option",{value:"",children:"-- เลือกองค์กร --"}),m.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),t.organization_id&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.organization_id})]}),e.jsxs("div",{children:[e.jsx(d,{children:"แบบประเมิน *"}),e.jsxs("select",{value:s.evaluation_id,onChange:a=>r("evaluation_id",a.target.value),className:"w-full border rounded px-3 py-2 dark:bg-gray-800 dark:text-white dark:border-gray-600",children:[e.jsx("option",{value:"",children:"-- เลือกแบบประเมิน --"}),u.map(a=>e.jsxs("option",{value:a.id,children:[a.title," (Grade ",a.grade_min,"-",a.grade_max,")"]},a.id))]}),t.evaluation_id&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.evaluation_id})]}),e.jsxs("div",{children:[e.jsx(d,{children:"ปีงบประมาณ *"}),e.jsx(x,{type:"number",value:s.fiscal_year,onChange:a=>r("fiscal_year",a.target.value),className:"dark:bg-gray-800 dark:text-white"}),t.fiscal_year&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.fiscal_year})]}),e.jsxs("div",{children:[e.jsx(d,{children:"วันหมดอายุ (ไม่บังคับ)"}),e.jsx(x,{type:"date",value:s.expires_at,onChange:a=>r("expires_at",a.target.value),className:"dark:bg-gray-800 dark:text-white"}),t.expires_at&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:t.expires_at})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(d,{children:["เลือกผู้ถูกประเมิน * (เลือกแล้ว ",s.evaluatee_ids.length," คน)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:j,className:"text-xs text-indigo-600 hover:underline",children:"เลือกทั้งหมด"}),e.jsx("button",{type:"button",onClick:y,className:"text-xs text-red-600 hover:underline",children:"ล้างการเลือก"})]})]}),e.jsx("input",{type:"text",value:c,onChange:a=>v(a.target.value),placeholder:"ค้นหาผู้ถูกประเมิน...",className:"w-full border rounded px-3 py-2 mb-2 dark:bg-gray-800 dark:text-white dark:border-gray-600"}),t.evaluatee_ids&&e.jsx("p",{className:"text-red-500 text-sm mb-2",children:t.evaluatee_ids}),e.jsx("div",{className:"border rounded dark:border-gray-600 max-h-64 overflow-y-auto",children:l.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"ไม่พบผู้ถูกประเมินที่มีการมอบหมายองศาขวา"}):l.map(a=>e.jsxs("label",{className:`flex items-center gap-3 px-4 py-2.5 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 border-b dark:border-gray-700 last:border-b-0 ${s.evaluatee_ids.includes(a.id)?"bg-indigo-50 dark:bg-indigo-900/30":""}`,children:[e.jsx("input",{type:"checkbox",checked:s.evaluatee_ids.includes(a.id),onChange:()=>b(a.id),className:"w-4 h-4 rounded text-indigo-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-800 dark:text-white",children:[a.fname," ",a.lname]}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",a.emid,") Grade ",a.grade]})]})]},a.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("a",{href:route("admin.access-codes.index"),className:"px-4 py-2 border rounded text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700",children:"ยกเลิก"}),e.jsx(A,{type:"submit",disabled:n,children:n?"กำลังสร้าง...":`สร้าง Access Code (${s.evaluatee_ids.length} รายการ)`})]})]})]})})})}export{Y as default};
