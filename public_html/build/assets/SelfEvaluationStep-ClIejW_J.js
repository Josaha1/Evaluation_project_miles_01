import{K as E,r as b,j as a,b as D,S as G}from"./app-DQ2VkJ7f.js";import{M as Q,B as f}from"./MainLayout-BTc9pcGZ.js";import{m as v}from"./proxy-DiGbqXPe.js";import{A as I}from"./index-DOQihDPJ.js";import"./Footer-TA0Z8X7z.js";import"./utils-ONoQxm8A.js";function R(){const{evaluation:j,current_part:p,step:c,total_steps:g,evaluatee_id:N,is_self:M,auth:w,group_index_to_resume:x}=E().props,[m,k]=b.useState({}),[o,y]=b.useState(0),h=p.aspects.flatMap(s=>{const t=new Set,r=(s.subaspects||[]).map(e=>(e.questions.forEach(l=>t.add(l.id)),{subaspectName:e.name,subaspectDescription:e.description||null,questions:e.questions})),i=s.questions.filter(e=>!t.has(e.id)),u=i.length>0?[{subaspectName:null,subaspectDescription:null,questions:i}]:[];return[...r,...u]}),n=h[o],d=(s,t)=>{k(r=>({...r,[s]:t}))},_=n.questions.every(s=>{const t=m[s.id];return t!==void 0&&t!==""&&!(Array.isArray(t)&&t.length===0)}),S=async()=>{const s=n.questions.reduce((t,r)=>{const i=m[r.id];return i!==void 0&&i!==""&&(t[r.id]=i),t},{});if(Object.keys(s).length>0)try{await D.post(route("evaluations.self.step",{step:c}),{evaluation_id:j.id,part_id:p.id,evaluatee_id:N??w.user.id,answers:s})}catch(t){return console.error("Error saving answers:",t),alert("เกิดข้อผิดพลาดในการบันทึก กรุณาลองใหม่")}o<h.length-1?y(o+1):G.visit(route("evaluations.self.questions",{step:c+1}),{method:"get",preserveScroll:!0,preserveState:!1})};b.useEffect(()=>{typeof x=="number"&&y(x)},[x]);const A=s=>{var i,u;const t=m[s.id]||"",r=e=>{var l;return t===e||((l=t==null?void 0:t.includes)==null?void 0:l.call(t,e))};switch(s.type){case"rating":return a.jsx("div",{className:"flex justify-center gap-2",children:[5,4,3,2,1].map(e=>a.jsx(f,{variant:r(e)?"default":"outline",className:"w-12 h-12 rounded-full",onClick:()=>d(s.id,e),children:e},e))});case"choice":return a.jsx("div",{className:"space-y-3 text-left",children:(i=s.options)==null?void 0:i.map(e=>a.jsx("button",{onClick:()=>d(s.id,e.id),className:`w-full px-4 py-3 border rounded-lg shadow-sm transition-all
                  ${r(e.id)?"bg-black text-white border-black":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100 dark:bg-gray-900 dark:text-white dark:border-gray-700 dark:hover:bg-gray-800"}`,children:a.jsx("span",{className:"block break-words text-sm md:text-base",children:e.label})},e.id))});case"multiple_choice":return a.jsx("div",{className:"space-y-2",children:(u=s.options)==null?void 0:u.map(e=>a.jsx(f,{variant:r(e.id)?"default":"outline",onClick:()=>{const l=t!=null&&t.includes(e.id)?t.filter(C=>C!==e.id):[...t||[],e.id];d(s.id,l)},className:"w-full",children:e.label},e.id))});case"open_text":return a.jsx("textarea",{value:t,onChange:e=>d(s.id,e.target.value),rows:4,className:"w-full p-3 border rounded text-black dark:text-white bg-white dark:bg-gray-800",placeholder:"พิมพ์ความคิดเห็นของคุณ..."});default:return null}};return a.jsx(Q,{title:"แบบประเมินตนเอง",children:a.jsxs("div",{className:"max-w-2xl mx-auto py-12 px-6 space-y-6",children:[a.jsxs(v.h2,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-xl font-bold text-violet-700 dark:text-violet-400 text-center",children:["ตอนที่ ",c," / ",g,": ",p.title]}),a.jsx(I,{mode:"wait",children:a.jsxs(v.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"bg-gray-50 dark:bg-gray-800 p-6 rounded-xl shadow-md",children:[n.subaspectName&&a.jsxs("p",{className:"text-sm font-semibold text-blue-700 mb-1",children:["ด้านย่อย: ",n.subaspectName]}),n.subaspectDescription&&a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:n.subaspectDescription}),n.questions.map(s=>a.jsxs("div",{className:"mb-6 text-left",children:[a.jsx("h4",{className:"text-base font-semibold text-indigo-700 mb-2",children:s.title}),A(s)]},s.id))]},o)}),a.jsx("div",{className:"text-center",children:a.jsx(f,{size:"lg",disabled:!_,onClick:S,className:"px-8 py-3 text-lg",children:o===h.length-1?c===g?"ส่งแบบประเมิน":"ไปยังตอนถัดไป":"ถัดไป"})})]})})}export{R as default};
