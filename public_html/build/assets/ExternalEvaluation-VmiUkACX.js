import{K as z,r as x,j as e,L as F,S as B}from"./app-CvBoKgfj.js";import{U as G}from"./user-D05-Tt5S.js";import{B as J}from"./building-2-CQheigYB.js";import{C as M,a as Q}from"./chevron-right-yZjgBDa2.js";import{S as v}from"./send-DK8XCqZX.js";import{C as R}from"./circle-alert-BO7xtVMv.js";import{L as U}from"./loader-circle-CWVqcMXz.js";import"./createLucideIcon-DRc0qRU9.js";function X(){const{evaluation:b,evaluatee:w,organization:S,parts:C,existingAnswers:h}=z().props,[i,p]=x.useState(0),[u,f]=x.useState({}),[j,y]=x.useState(!1),[k,N]=x.useState(!1),n=C.map(s=>{var t;const a=[];return s.questions&&a.push(...s.questions),(t=s.aspects)==null||t.forEach(r=>{var l;r.questions&&a.push(...r.questions),(l=r.subaspects)==null||l.forEach(o=>{o.questions&&a.push(...o.questions)})}),{part:s,questions:a}}).filter(s=>s.questions.length>0);x.useEffect(()=>{if(h&&Object.keys(h).length>0){const s={};Object.entries(h).forEach(([a,t])=>{s[Number(a)]=t}),f(s)}},[]);const d=n.reduce((s,a)=>s+a.questions.length,0),m=Object.keys(u).length,c=n[i],E=i===n.length-1,g=(s,a,t)=>{f(r=>({...r,[s]:{value:a,other_text:t}}))},_=()=>{y(!0);const s=Object.entries(u).map(([a,t])=>({question_id:Number(a),value:t.value,other_text:t.other_text||null}));B.post(route("external.evaluate.submit"),{answers:s},{onFinish:()=>y(!1)})},$=s=>{const a=u[s.id];return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:[e.jsx("h3",{className:"text-base font-medium text-gray-900 mb-4",children:s.title}),s.type==="rating"&&s.options.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3",children:s.options.map(t=>e.jsx("button",{type:"button",onClick:()=>g(s.id,String(t.value||t.score)),className:`px-4 py-3 rounded-lg border-2 text-sm font-medium transition-all ${(a==null?void 0:a.value)===String(t.value||t.score)?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-gray-50 text-gray-700 hover:border-gray-300"}`,children:t.label},t.id))}),s.type==="choice"&&s.options.length>0&&e.jsx("div",{className:"space-y-2",children:s.options.map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${(a==null?void 0:a.value)===String(t.value||t.id)?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:`q_${s.id}`,checked:(a==null?void 0:a.value)===String(t.value||t.id),onChange:()=>g(s.id,String(t.value||t.id)),className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:t.label})]},t.id))}),s.type==="open_text"&&e.jsx("textarea",{value:(a==null?void 0:a.value)||"",onChange:t=>g(s.id,t.target.value),rows:3,className:"w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"กรุณากรอกคำตอบ..."}),s.type==="multiple_choice"&&s.options.length>0&&e.jsx("div",{className:"space-y-2",children:s.options.map(t=>{const r=a!=null&&a.value?JSON.parse(a.value):[],l=r.includes(String(t.value||t.id));return e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${l?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>{const o=String(t.value||t.id),L=l?r.filter(O=>O!==o):[...r,o];g(s.id,JSON.stringify(L))},className:"w-4 h-4 text-indigo-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:t.label})]},t.id)})})]},s.id)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(F,{title:`ประเมิน - ${b.title}`}),e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("h1",{className:"text-lg font-bold text-gray-900 truncate",children:b.title})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsxs("span",{children:["ผู้ถูกประเมิน: ",e.jsx("strong",{className:"text-gray-700",children:w.name})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:S.name})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[e.jsxs("span",{children:["ตอบแล้ว ",m,"/",d," ข้อ"]}),e.jsxs("span",{children:["หัวข้อ ",i+1,"/",n.length]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${d>0?m/d*100:0}%`}})})]})]})}),e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6",children:[c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:c.part.name}),c.part.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:c.part.description})]}),e.jsx("div",{className:"space-y-4",children:c.questions.map($)})]}),e.jsxs("div",{className:"flex items-center justify-between mt-8 pb-8",children:[e.jsxs("button",{onClick:()=>p(s=>Math.max(0,s-1)),disabled:i===0,className:`flex items-center gap-2 px-5 py-3 rounded-xl font-medium ${i===0?"text-gray-400 cursor-not-allowed":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(M,{className:"w-4 h-4"}),"ก่อนหน้า"]}),E?e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-6 py-3 rounded-xl font-bold text-white bg-green-600 hover:bg-green-700 transition-colors",children:[e.jsx(v,{className:"w-4 h-4"}),"ส่งแบบประเมิน"]}):e.jsxs("button",{onClick:()=>p(s=>Math.min(n.length-1,s+1)),className:"flex items-center gap-2 px-5 py-3 rounded-xl font-medium text-white bg-indigo-600 hover:bg-indigo-700 transition-colors",children:["ถัดไป",e.jsx(Q,{className:"w-4 h-4"})]})]})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-14 h-14 bg-green-100 rounded-full mb-3",children:e.jsx(v,{className:"w-6 h-6 text-green-600"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"ยืนยันการส่งแบบประเมิน"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["คุณตอบคำถามแล้ว ",m," จาก ",d," ข้อ"]}),m<d&&e.jsxs("div",{className:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-amber-600 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-amber-700",children:"ยังมีคำถามที่ยังไม่ได้ตอบ"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>N(!1),className:"flex-1 px-4 py-3 border border-gray-300 rounded-xl text-gray-700 font-medium hover:bg-gray-50",children:"กลับแก้ไข"}),e.jsx("button",{onClick:_,disabled:j,className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 flex items-center justify-center gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 animate-spin"}),"กำลังส่ง..."]}):"ยืนยันส่ง"})]})]})})]})}export{X as default};
