import{K as p,r as i,S as o,j as e}from"./app-DwFO0JC_.js";import{t as g,M as _}from"./MainLayout-Cn07eYGn.js";import{B as A}from"./breadcrumb-CwZMHKPj.js";import{K as E}from"./key-round-BEjy6gWD.js";import{C as D}from"./circle-plus-DKROpdab.js";import{D as T}from"./download-BjSkjLB2.js";import{P as z}from"./printer-BIbInWYx.js";import{E as B}from"./eye-BjJQMveg.js";import{B as F}from"./ban-ecmk9vfZ.js";import{T as I}from"./trash-2-C6JCELIw.js";import"./utils-ONoQxm8A.js";import"./createLucideIcon-Cho3rf5W.js";import"./x-CIBpOcZX.js";function U(){const{codes:r,organizations:b,filters:x}=p().props,[m,f]=i.useState(x.search||""),[l,j]=i.useState(x.organization_id||""),[h,y]=i.useState(x.status||""),[n,u]=i.useState([]),{flash:a}=p().props;i.useEffect(()=>{const t=setTimeout(()=>{o.get(route("admin.access-codes.index"),{search:m,organization_id:l,status:h},{preserveState:!0,replace:!0})},400);return()=>clearTimeout(t)},[m,l,h]),i.useEffect(()=>{a!=null&&a.success&&g.success(a.success),a!=null&&a.error&&g.error(a.error)},[a]);const N=t=>{confirm("คุณแน่ใจหรือไม่ว่าต้องการยกเลิก Access Code นี้?")&&o.put(route("admin.access-codes.revoke",{accessCode:t}))},v=t=>{confirm("คุณแน่ใจหรือไม่ว่าต้องการลบ Access Code นี้?")&&o.delete(route("admin.access-codes.destroy",{accessCode:t}))},k=()=>{if(n.length===0){g.error("กรุณาเลือก Access Code ที่ต้องการพิมพ์");return}const t=document.createElement("form");t.method="POST",t.action=route("admin.access-codes.print-cards");const s=document.querySelector('meta[name="csrf-token"]');if(s){const d=document.createElement("input");d.type="hidden",d.name="_token",d.value=s.getAttribute("content")||"",t.appendChild(d)}n.forEach(d=>{const c=document.createElement("input");c.type="hidden",c.name="code_ids[]",c.value=String(d),t.appendChild(c)}),document.body.appendChild(t),t.submit(),document.body.removeChild(t)},w=t=>{u(s=>s.includes(t)?s.filter(d=>d!==t):[...s,t])},C=()=>{n.length===r.data.length?u([]):u(r.data.map(t=>t.id))},S=t=>{var s;return t.is_used&&((s=t.session)!=null&&s.completed_at)?e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:"ประเมินแล้ว"}):t.is_used?e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",children:"ถูกยกเลิก"}):t.expires_at&&new Date(t.expires_at)<new Date?e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",children:"หมดอายุ"}):e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",children:"พร้อมใช้"})};return e.jsx(_,{title:"จัดการ Access Codes",breadcrumb:e.jsx(A,{items:[{label:"แดชบอร์ดผู้ดูแลระบบ",href:route("admindashboard")},{label:"จัดการ Access Codes",active:!0}]}),children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white flex items-center gap-2",children:[e.jsx(E,{className:"w-7 h-7"}),"จัดการ Access Codes"]}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("a",{href:route("admin.access-codes.create"),className:"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 shadow",children:[e.jsx(D,{className:"w-5 h-5 mr-2"}),"สร้าง Code ใหม่"]}),e.jsxs("a",{href:route("admin.access-codes.export",{organization_id:l}),className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 shadow",children:[e.jsx(T,{className:"w-5 h-5 mr-2"}),"Export CSV"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[e.jsx("input",{type:"text",value:m,onChange:t=>f(t.target.value),placeholder:"ค้นหา code, ชื่อผู้ประเมิน...",className:"border rounded px-4 py-2 dark:bg-gray-900 dark:text-white flex-1 min-w-[200px]"}),e.jsxs("select",{value:l,onChange:t=>j(t.target.value),className:"border rounded px-4 py-2 dark:bg-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"ทุกองค์กร"}),b.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("select",{value:h,onChange:t=>y(t.target.value),className:"border rounded px-4 py-2 dark:bg-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"ทุกสถานะ"}),e.jsx("option",{value:"unused",children:"พร้อมใช้"}),e.jsx("option",{value:"used",children:"ใช้แล้ว"}),e.jsx("option",{value:"expired",children:"หมดอายุ"})]})]}),n.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-indigo-50 dark:bg-indigo-900/30 rounded-lg flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:["เลือกแล้ว ",n.length," รายการ"]}),e.jsxs("button",{onClick:k,className:"inline-flex items-center px-3 py-1.5 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700",children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),"พิมพ์ QR Cards"]})]}),r.data.length===0?e.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-20 border rounded bg-white dark:bg-gray-800 shadow",children:"ไม่พบ Access Code"}):e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-gray-800 rounded shadow",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-center w-10",children:e.jsx("input",{type:"checkbox",checked:n.length===r.data.length&&r.data.length>0,onChange:C,className:"w-4 h-4 rounded"})}),e.jsx("th",{className:"p-4 text-left",children:"Code"}),e.jsx("th",{className:"p-4 text-left",children:"องค์กร"}),e.jsx("th",{className:"p-4 text-left",children:"ผู้ถูกประเมิน"}),e.jsx("th",{className:"p-4 text-center",children:"ปี"}),e.jsx("th",{className:"p-4 text-center",children:"สถานะ"}),e.jsx("th",{className:"p-4 text-center",children:"วันหมดอายุ"}),e.jsx("th",{className:"p-4 text-center",children:"การจัดการ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:r.data.map(t=>{var s;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"p-4 text-center",children:e.jsx("input",{type:"checkbox",checked:n.includes(t.id),onChange:()=>w(t.id),className:"w-4 h-4 rounded"})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"font-mono text-sm font-bold text-indigo-600 dark:text-indigo-400",children:t.code})}),e.jsx("td",{className:"p-4 text-sm text-gray-700 dark:text-gray-300",children:((s=t.organization)==null?void 0:s.name)||"-"}),e.jsx("td",{className:"p-4 text-sm text-gray-700 dark:text-gray-300",children:t.evaluatee?`${t.evaluatee.fname} ${t.evaluatee.lname}`:"-"}),e.jsx("td",{className:"p-4 text-center text-sm",children:t.fiscal_year}),e.jsx("td",{className:"p-4 text-center",children:S(t)}),e.jsx("td",{className:"p-4 text-center text-sm text-gray-500",children:t.expires_at?new Date(t.expires_at).toLocaleDateString("th-TH"):"-"}),e.jsx("td",{className:"p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("a",{href:route("admin.access-codes.show",{accessCode:t.id}),className:"text-blue-600 hover:text-blue-800",title:"ดู QR Code",children:e.jsx(B,{className:"w-5 h-5"})}),!t.is_used&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>N(t.id),className:"text-amber-600 hover:text-amber-800",title:"ยกเลิก",children:e.jsx(F,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>v(t.id),className:"text-red-600 hover:text-red-800",title:"ลบ",children:e.jsx(I,{className:"w-5 h-5"})})]})]})})]},t.id)})})]})}),r.links.length>1&&e.jsx("div",{className:"flex justify-end mt-6 space-x-1",children:r.links.map((t,s)=>e.jsx("button",{disabled:!t.url,onClick:()=>t.url&&o.visit(t.url,{preserveScroll:!0,preserveState:!0}),className:`px-3 py-1 border rounded text-sm ${t.active?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-800 dark:text-white"}`,dangerouslySetInnerHTML:{__html:t.label}},s))})]})})}export{U as default};
