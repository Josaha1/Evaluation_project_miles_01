import{r as c,K as se,m as ie,j as a,S as N}from"./app-DQ2VkJ7f.js";import{M as oe,B as le,t as y}from"./MainLayout-BTc9pcGZ.js";import{B as de}from"./breadcrumb-D7MOHieF.js";import{_ as ce,c as ee,g as ue,a as me,b as U,v as pe,d as ae,u as ve,e as he,f as ge,S as W}from"./react-select.esm-DSdaeHML.js";import{L as m,I as D}from"./input-BYXBfTOG.js";import{C as fe}from"./card-DdDD-iKT.js";import"./Footer-TA0Z8X7z.js";import"./utils-ONoQxm8A.js";var be=["allowCreateWhileLoading","createOptionPosition","formatCreateLabel","isValidNewOption","getNewOptionData","onCreateOption","options","onChange"],te=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",p=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0,s=String(l).toLowerCase(),t=String(f.getOptionValue(p)).toLowerCase(),L=String(f.getOptionLabel(p)).toLowerCase();return t===s||L===s},q={formatCreateLabel:function(l){return'Create "'.concat(l,'"')},isValidNewOption:function(l,p,f,s){return!(!l||p.some(function(t){return te(l,t,s)})||f.some(function(t){return te(l,t,s)}))},getNewOptionData:function(l,p){return{label:p,value:l,__isNew__:!0}}};function xe(o){var l=o.allowCreateWhileLoading,p=l===void 0?!1:l,f=o.createOptionPosition,s=f===void 0?"last":f,t=o.formatCreateLabel,L=t===void 0?q.formatCreateLabel:t,M=o.isValidNewOption,Y=M===void 0?q.isValidNewOption:M,P=o.getNewOptionData,$=P===void 0?q.getNewOptionData:P,k=o.onCreateOption,n=o.options,r=n===void 0?[]:n,w=o.onChange,b=ce(o,be),V=b.getOptionValue,A=V===void 0?me:V,I=b.getOptionLabel,B=I===void 0?ue:I,x=b.inputValue,F=b.isLoading,O=b.isMulti,S=b.value,E=b.name,C=c.useMemo(function(){return Y(x,ee(S),r,{getOptionValue:A,getOptionLabel:B})?$(x,L(x)):void 0},[L,$,B,A,x,Y,r,S]),R=c.useMemo(function(){return(p||!F)&&C?s==="first"?[C].concat(U(r)):[].concat(U(r),[C]):r},[p,s,F,C,r]),u=c.useCallback(function(d,h){if(h.action!=="select-option")return w(d,h);var T=Array.isArray(d)?d:[d];if(T[T.length-1]===C){if(k)k(x);else{var g=$(x,x),G={action:"create-option",name:E,option:g};w(pe(O,[].concat(U(ee(S)),[g]),g),G)}return}w(d,h)},[$,x,O,E,C,k,w,S]);return ae(ae({},b),{},{options:R,onChange:u})}var Ce=c.forwardRef(function(o,l){var p=ve(o),f=xe(p);return c.createElement(he,ge({ref:l},f))}),_=Ce;const ne=()=>document.documentElement.classList.contains("dark");function $e(){const{divisions:o,departments:l,factions:p,position:f,mode:s,user:t}=se().props,[L,M]=c.useState(""),[Y,P]=c.useState(""),[$,k]=c.useState(ne()),{data:n,setData:r,post:w,put:b,processing:V,reset:A}=ie({emid:(t==null?void 0:t.emid)||"",prename:(t==null?void 0:t.prename)||"",fname:(t==null?void 0:t.fname)||"",lname:(t==null?void 0:t.lname)||"",sex:(t==null?void 0:t.sex)||"",division_id:(t==null?void 0:t.division_id)||"",department_id:(t==null?void 0:t.department_id)||"",faction_id:(t==null?void 0:t.faction_id)||"",position_id:(t==null?void 0:t.position_id)||"",grade:(t==null?void 0:t.grade)||"",birthdate:(t==null?void 0:t.birthdate)||"",password:"",role:(t==null?void 0:t.role)||"user",user_type:(t==null?void 0:t.user_type)||"internal"}),I=e=>{e.preventDefault();const i=s==="edit"?b:w,v=s==="edit"?route("admin.users.update",t.emid):route("admin.users.store");i(v,{onSuccess:()=>{y.success(s==="edit"?"✅ แก้ไขข้อมูลแล้ว":"✅ เพิ่มผู้ใช้งานแล้ว"),A("password")},onError:()=>y.error("❌ ไม่สามารถบันทึกได้")})},B=e=>{N.post(route("admin.departments.store"),{name:e,division_id:n.division_id},{onSuccess:()=>{y.success("✅ เพิ่มหน่วยงานใหม่แล้ว"),N.reload({only:["departments"]})},onError:()=>y.error("❌ ไม่สามารถเพิ่มหน่วยงานได้")})},x=e=>{N.post(route("admin.factions.store"),{name:e},{onSuccess:()=>{y.success("✅ เพิ่มหน่วยงานใหม่แล้ว"),N.reload({only:["departments"]})},onError:()=>y.error("❌ ไม่สามารถเพิ่มหน่วยงานได้")})},F=e=>{N.post(route("admin.positions.store"),{title:e},{onSuccess:()=>{y.success("✅ เพิ่มตำแหน่งใหม่แล้ว"),N.reload({only:["position"]})},onError:()=>y.error("❌ ไม่สามารถเพิ่มตำแหน่งได้")})},O=(e,i="name")=>e.map(v=>({value:v.id.toString(),label:v[i]})),S=O(o),E=O(l),C=O(p),R=O(f,"title");c.useEffect(()=>{const e=new MutationObserver(()=>{k(ne())});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>e.disconnect()},[]);const u=e=>({...e,colors:{...e.colors,primary:"#6366f1",primary25:"#e0e7ff",neutral0:"#fff",neutral5:"#f3f4f6",neutral10:"#e5e7eb",neutral20:"#d1d5db",neutral30:"#9ca3af",neutral80:"#111827"}}),d={control:e=>({...e,backgroundColor:"#fff",borderColor:"#d1d5db",borderRadius:"0.5rem",paddingLeft:"0.25rem",paddingRight:"0.25rem",fontSize:"0.875rem"}),menu:e=>({...e,backgroundColor:"#fff",borderRadius:"0.5rem",marginTop:4}),input:e=>({...e,color:"#111827"}),singleValue:e=>({...e,color:"#111827"}),option:(e,i)=>({...e,backgroundColor:i.isSelected?"#6366f1":i.isFocused?"#f3f4f6":"#fff",color:i.isSelected?"#fff":"#111827",cursor:"pointer"})},[h,T]=c.useState(""),[g,G]=c.useState(""),[j,re]=c.useState(""),z=Array.from({length:31},(e,i)=>({value:(i+1).toString().padStart(2,"0"),label:(i+1).toString()})),K=[{value:"ชาย",label:"ชาย"},{value:"หญิง",label:"หญิง"}],H=[{value:"นาย",label:"นาย"},{value:"นางสาว",label:"นางสาว"},{value:"นาง",label:"นาง"}],J=[{value:"user",label:"User"},{value:"admin",label:"Admin"}],Q=[{value:"internal",label:"ภายใน"},{value:"external",label:"ภายนอก"}],X=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"].map((e,i)=>({value:(i+1).toString().padStart(2,"0"),label:e})),Z=Array.from({length:100},(e,i)=>{const v=new Date().getFullYear()-i;return{value:v.toString(),label:`${v+543} (พ.ศ.)`}});return c.useEffect(()=>{if(h&&g&&j){const e=new Date(parseInt(j),parseInt(g)-1,parseInt(h)).toISOString().split("T")[0];r("birthdate",e)}},[h,g,j]),c.useEffect(()=>{if(n.division_id&&n.user_type==="external"){const e=n.division_id.toString().padStart(2,"0"),i=Math.floor(100+Math.random()*900),v=`E${e}${i}`;M(v),r("emid",v)}},[n.user_type,n.division_id]),c.useEffect(()=>{if(h&&g&&j){const e=`${j}-${g}-${h}`;if(r("birthdate",e),s==="create"){const i=(parseInt(j)+543).toString(),v=`${h}${g}${i}`;P(v),r("password",v)}}},[h,g,j]),a.jsx(oe,{title:s==="edit"?"แก้ไขผู้ใช้งาน":"เพิ่มผู้ใช้งาน",breadcrumb:a.jsx(de,{items:[{label:"แดชบอร์ดผู้ดูแลระบบ",href:route("admindashboard")},{label:"จัดการสมาชิก",href:route("admin.users.index")},{label:s==="edit"?"แก้ไขผู้ใช้":"เพิ่มสมาชิก",active:!0}]}),children:a.jsx("div",{className:"max-w-5xl mx-auto px-6 py-10",children:a.jsxs(fe,{className:"p-8 space-y-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-indigo-600",children:s==="edit"?"✏️ แก้ไขผู้ใช้งาน":"➕ เพิ่มผู้ใช้งาน"}),a.jsxs("form",{onSubmit:I,className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx(m,{children:"รหัสพนักงาน (EMID)"}),a.jsx(D,{value:n.emid,onChange:e=>r("emid",e.target.value),readOnly:n.user_type==="external",className:n.user_type==="external"?"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white cursor-not-allowed":"dark:bg-gray-800 dark:text-white"}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["*"," ",n.user_type==="external"?"สร้างอัตโนมัติจากสายงาน":"กรอกเลข 6 หลักเองได้"]})]}),a.jsxs("div",{children:[a.jsx(m,{children:"คำนำหน้าชื่อ"}),a.jsx(W,{options:H,value:H.find(e=>e.value===n.prename)||null,onChange:e=>r("prename",(e==null?void 0:e.value)||""),isClearable:!0,placeholder:"เลือก...",theme:u,styles:d})]}),a.jsxs("div",{children:[a.jsx(m,{children:"ชื่อ"}),a.jsx(D,{value:n.fname,onChange:e=>r("fname",e.target.value),className:"dark:bg-gray-800 dark:text-white"})]}),a.jsxs("div",{children:[a.jsx(m,{children:"นามสกุล"}),a.jsx(D,{value:n.lname,onChange:e=>r("lname",e.target.value),className:"dark:bg-gray-800 dark:text-white"})]}),a.jsxs("div",{children:[a.jsx(m,{children:"เพศ"}),a.jsx(_,{options:K,value:K.find(e=>e.value===n.sex)||null,onChange:e=>r("sex",(e==null?void 0:e.value)||""),isClearable:!0,placeholder:"เลือก...",theme:u,styles:d})]}),a.jsxs("div",{children:[a.jsx(m,{children:"ตำแหน่งงาน"}),a.jsx(_,{options:R,value:R.find(e=>e.value===n.position_id)||null,onChange:e=>r("position_id",(e==null?void 0:e.value)||""),onCreateOption:F,isClearable:!0,placeholder:"เลือก...",theme:u,styles:d})]}),a.jsxs("div",{children:[a.jsx(m,{children:"ระดับ"}),a.jsx(D,{value:n.grade,onChange:e=>r("grade",e.target.value),className:"dark:bg-gray-800 dark:text-white"})]}),a.jsxs("div",{children:[a.jsx(m,{children:"กอง"}),a.jsx(_,{options:E,value:E.find(e=>e.value===n.department_id)||null,onChange:e=>r("department_id",(e==null?void 0:e.value)||""),onCreateOption:B,isClearable:!0,placeholder:"เลือก...",theme:u,styles:d})]}),a.jsxs("div",{children:[a.jsx(m,{children:"ฝ่าย"}),a.jsx(_,{options:C,value:C.find(e=>e.value===n.faction_id)||null,onChange:e=>r("faction_id",(e==null?void 0:e.value)||""),onCreateOption:x,isClearable:!0,placeholder:"เลือก...",theme:u,styles:d})]}),a.jsxs("div",{children:[a.jsx(m,{children:"สายปฏิบัติงาน"}),a.jsx(_,{options:S,value:S.find(e=>e.value===n.division_id)||null,onChange:e=>r("division_id",(e==null?void 0:e.value)||""),isClearable:!0,placeholder:"เลือก...",theme:u,styles:d})]}),s==="create"&&a.jsxs("div",{children:[a.jsx(m,{children:"วันเกิด"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(W,{options:z,value:z.find(e=>e.value===h),onChange:e=>T((e==null?void 0:e.value)||""),isClearable:!0,placeholder:"วัน",theme:u,styles:u,className:"w-1/3"}),a.jsx(W,{options:X,value:X.find(e=>e.value===g),onChange:e=>G((e==null?void 0:e.value)||""),isClearable:!0,placeholder:"เดือน",theme:u,styles:d,className:"w-1/3"}),a.jsx(W,{options:Z,value:Z.find(e=>e.value===j),onChange:e=>re((e==null?void 0:e.value)||""),isClearable:!0,placeholder:"ปี",theme:u,styles:d,className:"w-1/3"})]})]}),a.jsxs("div",{children:[a.jsx(m,{children:"หน้าที่"}),a.jsx(_,{options:J,value:J.find(e=>e.value===n.role)||null,onChange:e=>r("role",(e==null?void 0:e.value)||""),isClearable:!0,placeholder:"เลือก...",theme:u,styles:d})]}),a.jsxs("div",{children:[a.jsx(m,{children:"ประเภทบุคคลากร"}),a.jsx(_,{options:Q,value:Q.find(e=>e.value===n.user_type)||null,onChange:e=>r("user_type",(e==null?void 0:e.value)||""),isClearable:!0,placeholder:"เลือก...",theme:u,styles:d})]}),s==="create"&&a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(m,{children:"รหัสผ่านเริ่มต้น (จากวันเกิด)"}),a.jsx(D,{value:n.password,readOnly:!0,className:"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white cursor-not-allowed"})]}),a.jsx("div",{className:"md:col-span-2 flex justify-end pt-4",children:a.jsxs(le,{type:"submit",disabled:V,children:["💾"," ",s==="edit"?"อัปเดตผู้ใช้":"บันทึกผู้ใช้ใหม่"]})})]})]})})})}export{$e as default};
